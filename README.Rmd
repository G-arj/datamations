---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
# Global chunk options
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "80%",
  warning = FALSE,
  message = FALSE
)

# Specific options
knitr::opts_template$set(
  # Actually generating the datamations - don't show the code or results (returns FALSE right now), and cache the image so it's not regenerated each time
  datamations_generate = list(
    cache = TRUE,
    echo = FALSE,
    results = "hide"
  )
)
```

# datamations

datamations is a framework for automatic generation of explanation of plots and tables from analysis code. It automatically turns code into animations, showing the steps that led to a plot or a table.

## Installation

You can install datamations from GitHub with:

```r
# install.packages("devtools")
devtools::install_github("jhofman/datamations)
```

## Usage

To get started, load datamations and the tidyverse:

```{r load-libraries}
library(datamations)
library(tidyverse)
```

### Plot-based datamations

A plot-based datamation shows a plot of what the data looks like at each step of a pipeline, animated by the transitions that lead to each state. The following shows an example taking the built-in `small_salary` data set, grouping by `Degree`, and calculating the mean `Salary`.

First, define the code for the pipeline, and titles for each of the steps:

```{r mean-salary-degree-plot-setup}
mean_salary_by_degree_pipe <- "small_salary %>% group_by(Degree) %>% summarize(mean = mean(Salary))"

degree_title_step1 <- "Step 1: Each dot shows one person\n and each group shows degree type"
degree_title_step2 <- "Step 2: Next you plot the salary of each person\n within each group"
degree_title_step3 <- "Step 3: Lastly you plot the average salary \n of each group and zoom in"
```

And generate the datamation with `datamation_sanddance()`:

```{r mean-salary-degree-plot-datamations, eval = FALSE}
datamation_sanddance(
  pipeline = mean_salary_by_degree_pipe,
  output = "mean_salary_group_by_degree.gif",
  titles = c(degree_title_step1, degree_title_step2, degree_title_step3),
  nframes = 30
)
```

```{r mean-salary-degree-plot-datamations-generate, opts.label = 'datamations_generate'}
datamation_sanddance(
  pipeline = mean_salary_by_degree_pipe,
  output = here::here("man", "figures", "README-mean_salary_group_by_degree.gif"),
  titles = c(degree_title_step1, degree_title_step2, degree_title_step3),
  nframes = 30
)
```

```{r mean-salary-degree-plot-datamations-gif, echo = FALSE}
knitr::include_graphics("man/figures/README-mean_salary_group_by_degree.gif")
```

You can group by multiple variables, as in this example, grouping by `Degree` and `Work` before calculating the mean `Salary`:

```{r mean-salary-degree-plot-work-setup}
mean_salary_by_degree_work <- "small_salary %>% group_by(Degree, Work) %>% summarize(mean = mean(Salary))"
work_degree_title_step1 <- "Step 1: Each dot shows one person and each group\n shows degree type AND work setting"
```

```{r mean-salary-degree-work-plot-datamations, eval = FALSE}
datamation_sanddance(
  pipeline = mean_salary_by_degree_work,
  output = "mean_salary_group_by_degree_work.gif",
  titles = c(work_degree_title_step1, degree_title_step2, degree_title_step3),
  nframes = 30
)
```

```{r mean-salary-degree-work-plot-datamations-generate, opts.label = 'datamations_generate'}
datamation_sanddance(
  pipeline = mean_salary_by_degree_work,
  output = here::here("man", "figures", "README-mean_salary_group_by_degree_work.gif"),
  titles = c(work_degree_title_step1, degree_title_step2, degree_title_step3),
  nframes = 30
)
```

```{r mean-salary-degree-work-plot-datamations-gif, echo = FALSE}
knitr::include_graphics("man/figures/README-mean_salary_group_by_degree_work.gif")
```

### Table-based datamations

A table-based datamation shows a mock table of what the data looks like at each step of pipeline, again animated by the transitions that lead to each state. The following shows our same first example: taking the built-in `small_salary` data set, grouping by `Degree`, and calculating the mean `Salary`, using the same pipeline.

You can generate a table-based datamation with `datamation_tibble()`:

```{r mean-salary-degree-work-table-datamations, eval = FALSE}
datamation_tibble(
  pipeline = mean_salary_by_degree_pipe,
  output = "mean_salary_group_by_degree.gif"
)
```

```{r mean-salary-degree-work-table-datamations-generate, opts.label = 'datamations_generate'}
# Excluding the titles for now - the title framework seems to be different between plots/tables so I'll dig into that later.
#   titles = c(
#     "Grouping by Degree and Work",
#     "Calculating the Mean of Each Group"
#   )

datamation_tibble(
  pipeline = mean_salary_by_degree_pipe,
  output = here::here("man", "figures", "README-mean_salary_group_by_degree-table.gif")
)
```

```{r mean-salary-degree-work-table-datamations-gif, echo = FALSE}
knitr::include_graphics("man/figures/README-mean_salary_group_by_degree-table.gif")
```

Datamations work on any dataset provided, as in this example taking `mtcars` and grouping by `cyl`:

```{r mtcars-group-cyl-datamations, eval = FALSE}
mtcars_group_cyl <- "mtcars %>% group_by(cyl)"
datamation_tibble(mtcars_group_cyl, output = "mtcars_group_cyl.gif")
```

```{r mtcars-group-cyl-datamations-generate, opts.label = 'datamations_generate'}
datamation_tibble(
  pipeline = "mtcars %>% group_by(cyl)",
  output = here::here("man", "figures", "README-mtcars_group_cyl.gif")
)
```

```{r mtcars-group-cyl-datamations-gif, echo = FALSE}
knitr::include_graphics(here::here("man", "figures", "README-mtcars_group_cyl.gif"))
```
